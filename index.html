<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-166005805-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-166005805-1');
    </script>

    <meta charset="utf-8" />
    <title>Traces Netcoupe</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>

    <script src="https://unpkg.com/leaflet-canvas-marker@0.2.0"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script> -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>

    <script src="https://kit.fontawesome.com/e8228d78b3.js" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sidebar-v2@0.4.0/css/leaflet-sidebar.css" integrity="sha256-FIZlRBXnW3JL4Pb7oAW2QNCGAG5uJqYlFbZb9qAKaso=" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/sidebar-v2@0.4.0/js/leaflet-sidebar.js" integrity="sha256-NQzshErvg7W7EhLN0umegsGFdejTaaAWM/vzq1yfSEg=" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

    <link rel="stylesheet" href="https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.css" />
    <script src="https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.js"></script>

    <script src="https://rawgit.com/mapshakers/leaflet-control-window/master/src/L.Control.Window.js"></script>
    <link rel="stylesheet" href="https://rawgit.com/mapshakers/leaflet-control-window/master/src/L.Control.Window.css" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>

    <script src="https://www.amcharts.com/lib/4/core.js"></script>
    <script src="https://www.amcharts.com/lib/4/charts.js"></script>
    <script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/spin.js/2.3.2/spin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.Spin/1.1.2/leaflet.spin.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/jszip@3.4.0/dist/jszip.min.js" integrity="sha256-Uktz9Z+RdiKZoEPBkqU9DGKjNVUe9eVSlKB3EMd4uto=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip-utils@0.1.0/dist/jszip-utils.min.js" integrity="sha256-5GhqDpPB1bpRluB0hmS7EJkMH+EVyqUP00CvFEksTVw=" crossorigin="anonymous"></script>
    <!--
    Mandatory in IE 6, 7, 8 and 9.
    -->
    <!--[if IE]>
    <script src="https://cdn.jsdelivr.net/npm/jszip-utils@0.1.0/dist/jszip-utils-ie.min.js" integrity="sha256-yOor9fUsttajkdD0TLmQRraytTF7OIyrNiI/aQH5JO0=" crossorigin="anonymous"></script>
    <![endif]-->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/3.2.0/css/bootstrap-colorpicker.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/3.2.0/js/bootstrap-colorpicker.min.js"></script>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.css" integrity="sha256-XzD3RpaHPv7lzX9qt+2n1j5cWj48O24KsgaGYpKN8x8=" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.js" integrity="sha256-siofc4Uwjlra3YWkwthOn8Uj69cNN4aMug/iOHNiRgs=" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="css/application.css">
    <link rel="stylesheet" href="css/traces.css">
    <link rel="stylesheet" href="css/statistics.css">
    <link rel="stylesheet" href="css/airspace.css">
 
    <script src="js/common.js"></script>
    <script src="js/application.js"></script>
    <script src="js/openAipAirspace.js"></script>
    <script src="js/airspace.js"></script>
    <script src="js/rasterTracks.js"></script>
    <script src="js/vectorTracks.js"></script>
    <script src="js/measuringTool.js"></script>
    <script src="js/statistics.js"></script>
    <script src="js/airports.js"></script>

    <script src="js/draw-texts.js"></script>
    <script src="js/draw.js"></script>

    <script src="js/covid.js"></script>
</head>
<body>    
    <div id="sidebar" class="sidebar collapsed">    
        <!-- Nav tabs -->
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab"><i class="fa fa-info"></i></a></li>
                <li><a href="#layers" role="tab"><i class="fas fa-layer-group"></i></a></li>
                <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
            </ul>
        </div>

        <!-- Tab panes -->
        <div class="sidebar-content">
            <div class="sidebar-pane" id="home">
                <h1 class="sidebar-header">
                    Cumulative Tracks
                    <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>
                <div class="container">
                    <div class="row">
                    <div class="col-sm-6">
                        <div class="item">Analyse du:</div>
                    </div>
                    <div class="col-sm-6">
                        <div id="start-date" class="item"></div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-6">
                        <div class="item">Durée calcul:</div>
                    </div>
                    <div class="col-sm-6">
                        <div id="duration" class="item"></div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-6">
                        <div class="item">Nb Vols:</div>
                    </div>
                    <div class="col-sm-2">
                        <div id="processed-flights-count" class="item"></div>
                    </div>
                    <div class="col-sm-2"><span>/</span></div>
                    <div class="col-sm-2">
                        <div id="flights-count" class="item"></div>
                    </div>
                </div>
                </div>
            </div>

            <div class="sidebar-pane" id="layers">
                <h1 class="sidebar-header">Layers<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                <div class="container">
                    <!-- Tracks layer selection-->
                    <div class="row disabled" id="switch-tracks-container">
                        <div class="col-sm-5">
                            <label class="form-check-label"><input type="checkbox" class="form-check-input" id="chk-vector-tracks" checked>Traces Cumulées</label>
                        </div>
                    </div>
                    <!-- Airspace -->
                    <div class="row disabled" id="switch-airspace-container">
                        <div class="col-sm-3">
                            <label class="form-check-label"><input type="checkbox" class="form-check-input" id="switch-airspace">Airspace</label>
                        </div>
                        <div class="col-sm-9">
                            <div class="btn-group btn-group-sm btn-group-toggle disabled" data-toggle="buttons" id="group-airspace-layer-selector">

                                <label class="btn btn-outline-primary active" data-toggle="tooltip-openair">
                                    <input type="radio" name="options" id="chk-vector-airspace" autocomplete="off" checked> Vector
                                </label>

                                <label class="btn btn-outline-primary" data-toggle="tooltip-openaip-tiles">
                                    <input type="radio" name="options" id="chk-openaip-airspace" autocomplete="off"> OpenAip Tiles
                                </label>

                                
                                <label class="btn btn-outline-primary" data-toggle="tooltip">
                                    <input type="radio" name="options" id="chk-openaip-vector-airspace" autocomplete="off">OpenAip Vector
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Airports-->
                    <div class="row disabled" id="switch-airports-container">
                        <div class="col-sm-3">
                            <label class="form-check-label"><input type="checkbox" class="form-check-input" id="chk-airports">Aerodromes</label>
                        </div>
                    </div>
                    <!-- Measuring tool -->
                    <div class="row">
                        <div class="col-sm-12">
                            <label class="form-check-label"><input class="form-check-input" type="checkbox" id="chk-show-measuring-tools">Outils de mesure</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <label class="form-check-label"><input class="form-check-input" type="checkbox" id="chk-show-drawing-tools">Outils de dessin</label>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Settings -->
            <div class="sidebar-pane" id="settings">
                <h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                <div class="container">
                    <!-- Color Picker -->
                    <div class="row" id="color-picker-layer-container">
                        <div class="col-sm-5">
                            <div class="item">Couleur Traces: </div>
                        </div>
                        <div class="col-sm-7">
                            <div id="color-picker" class="input-group" title="Using input value">
                                <span class="input-group-append">
                                    <span class="input-group-text colorpicker-input-addon"><i></i></span>
                                </span>
                                </div>
                        </div>
                    </div>

                    <!-- Scroll wheel zoom -->
                    <div class="row" id="scroll-wheel-zoom-container">
                        <div class="row">
                            <div class="col-sm-12">
                                <label class="form-check-label"><input type="checkbox" class="form-check-input" id="chk-scroll-wheel-zoom" checked>Scroll wheel zoom</label>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

        </div>
    </div>

    <div id="map"></div>

    <!--- Clipboard container -->
    <div class="d-none">
        <p id="clipboard-content"></p>
    </div>

</body>
<script src="js/interface.js"></script>
<script>
var isAirspaceShown = false;

// --- Map related --
var zoomLevel = 6;
var maxZoomLevel = 14;
var center = [47.5, 4.8];

var tracksMetaData = null;
var _map = null;
var _isAirspaceVisible = false;
var _layerOpenAirspaceLabels = null;
var _layerOpenAipTilesAirspace = null;

var _layerOpenAipVectorAirspace = null;
var _layerOpenAipVectorAirspaceLabels = null;
var _isLayerOpenAipVectorAirspaceLabelsShown = false;

var _statWindow = null
var _easyButton = null;

  // ---------- Document loaded ----------
$(function () {
    // --- Parse URL parameters ---
    var isSilent = false;
    var urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('covid')) {
        isSilent = true;
    }
    if (urlParams.has('year')) {
        var targetYear = parseInt(urlParams.get('year'));
        updateUrlsForTargetYear(targetYear);    // Update URLs so that they point to the year related data
    }

    setupMap();
    setupEasyButtons();
    initInterface();

    setupVectorTracks(isSilent);
    setupRasterTracks(isSilent);
    setupAirports();

    setupDraw();

    // --- Parse URL parameters ---    
    if (urlParams.has('covid')) {
        _isCovidFlavor = true;
        var covidParam = urlParams.get('covid');
        handleCovidUrlParameter(covidParam);
    }
    else {
        configureDraw(); // Standard drawing tools configuration
    }

    

});
</script>